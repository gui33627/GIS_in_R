mutate( STOP_FRISK_TIME = format(STOP_FRISK_TIME, "%H:%M:%S"))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = format(`Stop Frisk Time`, "%H:%M:%S"), STOP_FRISK_DATE = format(STOP_FRISK_DATE, "%Y-%m-%d"))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = format(STOP_FRISK_TIME, "%H:%M:%S"), STOP_FRISK_DATE = format(STOP_FRISK_DATE, "%Y-%m-%d"))
sqf2017$STOP_FRISK_TIME <- as.POSIXct(sqf2017$STOP_FRISK_TIME, format="%H:%M:%S")
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
test <- rbind(sqf2017_shape,sqf2018_shape,sqf2019_shape)
sqf2017_shape$STOP_FRISK_TIME
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
head(sqf2017)
class(sqf2017$STOP_FRISK_DATE)
class(sqf2017$STOP_FRISK_TIME)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
head(sqf2019)
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
test <- rbind(sqf2017_shape,sqf2018_shape,sqf2019_shape)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
st_write(sqf2017_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
sqf2017_shape$STOP_FRISK_ID
st_write(sqf2018_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2018_BURGLARY.shp")
colnames(sqf2017_shape)
colnames(sqf2017_shape)[1:3] <- c("sqf_ID", "sqf_date","sqf_time")
st_write(sqf2017_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
st_write(sqf2017_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
knitr::opts_chunk$set(echo = TRUE)
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
colnames(sqf2017_shape)
str(sqf2017_shape)
st_write(sqf2017_shape[,c(1:3,ncol(sqf2017_shape))], "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
View(sqf2017_shapefile)
View(sqf2017_shape)
colnames(sqf2017_shape)
?st_write
st_write(sqf2017_shape[,c(1:6,ncol(sqf2017_shape))], "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp",
overwrite = T)
st_write(sqf2017_shape[,c(1:6,ncol(sqf2017_shape))], "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp",
layer_options = "OVERWRITE=true")
st_write(sqf2017_shape[,c(1:6,ncol(sqf2017_shape))], "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp",
layer_options = "OVERWRITE=yes")
colnames(sqf2017_shape)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
colnames(sqf2017_shape)
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
st_write(sqf2018_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2018_BURGLARY.shp")
colnames(sqf2017_shape)
?gsub
gsub("_", ".", colnames(sqf2017_shape))
colnames(sqf2019_shape) <- gsub("_", ".", colnames(sqf2019_shape))
st_write(sqf2019_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2019_BURGLARY.shp")
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2019_shape) <- gsub("_", " ", colnames(sqf2019_shape))
st_write(sqf2017_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
View(sqf2017_shapefile)
library(sf)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
colnames(sqf2017_shape)
colnames(sqf2017_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_LOCATION", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2017_shape)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
colnames(sqf2017_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("STOP_LOCATION", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECTED_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2017_shape)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
colnames(sqf2017_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECTED_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2017_shape)
library(sf)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
colnames(sqf2017_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECTED_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2018_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("SUSPECT_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("SUSPECTED_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("_", " ", colnames(sqf2018_shape))
colnames(sqf2019_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("SUSPECT_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("SUSPECTED_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("_", " ", colnames(sqf2019_shape))
colnames(sqf2019_shape)
library(sf)
sqf2017 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/csi-2947-2019-sqf-cy2017-updated1-9-2020.xlsx") %>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")))
sqf2018 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2018.xlsx")%>%
mutate( `Stop Frisk Time` = as.character(format(`Stop Frisk Time`, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2019 <- readxl::read_xlsx("/Users/junhui/Documents/R/GIS/Howto/sqf2017-2019/sqf-2019.xlsx")%>%
mutate( STOP_FRISK_TIME = as.character(format(STOP_FRISK_TIME, "%H:%M:%S")), STOP_FRISK_DATE = as.character(format(STOP_FRISK_DATE, "%Y-%m-%d")))
sqf2017 <- sqf2017[complete.cases(cbind(sqf2017$STOP_LOCATION_X, sqf2017$STOP_LOCATION_Y)),]
sqf2017 <- sqf2017[sqf2017$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2017_shape <- st_as_sf(sqf2017, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
# tm_shape(sqf2017_shape) + tm_dots()
sqf2018 <- sqf2018[complete.cases(cbind(sqf2018$STOP_LOCATION_X, sqf2018$STOP_LOCATION_Y)),]
sqf2018 <- sqf2018[sqf2018$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2018_shape <- st_as_sf(sqf2018, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[complete.cases(cbind(sqf2019$STOP_LOCATION_X, sqf2019$STOP_LOCATION_Y)),]
# sqf2019_ROBBERY <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "ROBBERY",]
# sqf2019_ROBBERY_shape <- st_as_sf(sqf2019_ROBBERY, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
sqf2019 <- sqf2019[sqf2019$SUSPECTED_CRIME_DESCRIPTION == "BURGLARY",]
sqf2019_shape <- st_as_sf(sqf2019, coords=c("STOP_LOCATION_X", "STOP_LOCATION_Y"), crs=2263)
colnames(sqf2019_shape)[which(colnames(sqf2019_shape)=="STOP_ID_ANONY")] <- "STOP_FRISK_ID"
colnames(sqf2018_shape)[which(colnames(sqf2018_shape)=="Stop Frisk Time")] <- "STOP_FRISK_TIME"
setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2019_shape))
setdiff(colnames(sqf2019_shape), colnames(sqf2017_shape))
setdiff(colnames(sqf2017_shape), colnames(sqf2018_shape))
setdiff(colnames(sqf2018_shape), colnames(sqf2017_shape))
delete <- c(setdiff(colnames(sqf2018_shape), colnames(sqf2019_shape)), setdiff(colnames(sqf2019_shape), colnames(sqf2018_shape)))
sqf2017_shape <- sqf2017_shape[,!colnames(sqf2017_shape) %in% delete]
sqf2018_shape <- sqf2018_shape[,!colnames(sqf2018_shape) %in% delete]
sqf2019_shape <- sqf2019_shape[,!colnames(sqf2019_shape) %in% delete]
sqf2017_shape <- sqf2017_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2018_shape <- sqf2018_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
sqf2019_shape <- sqf2019_shape %>% select("STOP_FRISK_ID", "STOP_FRISK_DATE","STOP_FRISK_TIME","YEAR2","MONTH2","DAY2","SUSPECTED_CRIME_DESCRIPTION",
"SUSPECT_REPORTED_AGE" , "SUSPECT_SEX", "SUSPECT_RACE_DESCRIPTION", "SUSPECT_HEIGHT", "SUSPECT_WEIGHT", "SUSPECT_EYE_COLOR",
"SUSPECT_HAIR_COLOR","STOP_LOCATION_PRECINCT","STOP_LOCATION_FULL_ADDRESS","STOP_LOCATION_STREET_NAME", "STOP_LOCATION_BORO_NAME", "geometry")
identical(colnames(sqf2017_shape),colnames(sqf2018_shape))
identical(colnames(sqf2017_shape),colnames(sqf2019_shape))
colnames(sqf2017_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECT_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("SUSPECTED_", "", colnames(sqf2017_shape))
colnames(sqf2017_shape) <- gsub("_", " ", colnames(sqf2017_shape))
colnames(sqf2018_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("SUSPECT_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("SUSPECTED_", "", colnames(sqf2018_shape))
colnames(sqf2018_shape) <- gsub("_", " ", colnames(sqf2018_shape))
colnames(sqf2019_shape) <- gsub("STOP_FRISK_", "sqf ", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("STOP_LOCATION_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("SUSPECT_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("SUSPECTED_", "", colnames(sqf2019_shape))
colnames(sqf2019_shape) <- gsub("_", " ", colnames(sqf2019_shape))
st_write(sqf2017_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
st_write(sqf2018_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2018_BURGLARY.shp")
st_write(sqf2019_shape, "/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2019_BURGLARY.shp")
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp")
sqf2018_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2018_BURGLARY.shp")
sqf2019_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2019_BURGLARY.shp")
ggplot() + geom_sf(data = NYC_boroughs) + geom_sf(data = sqf2017_shapefile) +
geom_sf(data = sqf2018_shapefile, color = "blue") + geom_sf(data = sqf2019_shapefile, color = "red")
sqf2017to2019 <- rbind(sqf2017_shapefile, sqf2018_shapefile, sqf2019_shapefile)
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp", stringsAsFactor = F)
?st_read
sqf2017_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2017_BURGLARY.shp", stringsAsFactors = F)
sqf2018_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2018_BURGLARY.shp", stringsAsFactors = F)
sqf2019_shapefile <- st_read("/Users/junhui/Documents/R/GIS/Howto/GIS_in_R.merging/sqf2019_BURGLARY.shp", stringsAsFactors = F)
sqf2017to2019 <- rbind(sqf2017_shapefile, sqf2018_shapefile, sqf2019_shapefile)
head(sqf2017to2019)
ggplot() + geom_sf(data = NYC_boroughs) + geom_sf(data = sqf2017to2019)
st_crs(sqf2017_shapefile) == st_crs(sqf2018_shapefile)
st_crs(sqf2017_shapefile)
test <- st_crs(sqf2017_shapefile)
test$input
st_crs(sqf2017_shapefile)$input
library(sf)
library(ggplot2)
sqf2017_shapefile <- st_read("sqf2017_BURGLARY.shp", stringsAsFactors = F)
sqf2018_shapefile <- st_read("sqf2018_BURGLARY.shp", stringsAsFactors = F)
sqf2019_shapefile <- st_read("sqf2019_BURGLARY.shp", stringsAsFactors = F)
ggplot() + geom_sf(data = NYC_boroughs) + geom_sf(data = sqf2017_shapefile) +
geom_sf(data = sqf2018_shapefile, color = "blue") + geom_sf(data = sqf2019_shapefile, color = "red")
sqf2017to2019 <- rbind(sqf2017_shapefile, sqf2018_shapefile, sqf2019_shapefile)
# st_crs(sqf2017_shapefile)$input
ggplot() + geom_sf(data = NYC_boroughs) + geom_sf(data = sqf2017to2019)
# st_write(sqf2017to2019, "sqf2017to2019.shp")
